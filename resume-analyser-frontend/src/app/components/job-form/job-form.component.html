<div class="container mx-auto p-6">
    <h1 class="text-3xl font-bold mb-6 text-gray-800">Resume Analyser Tool</h1>
    <p class="text-gray-500 mb-6 text-sm">Analyse how well your resume matches a job description and get AI-powered suggestions.</p>

    <!-- Optional: Upload Job Description PDF -->
    <div class="mb-6 p-5 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-100 shadow-sm">
        <div class="flex items-center justify-between mb-3">
        <div>
            <h2 class="text-sm font-semibold text-blue-800 uppercase tracking-wide">Quick Fill from Job PDF</h2>
            <p class="text-xs text-blue-600 mt-0.5">Upload a job description PDF to auto-fill the form below</p>
        </div>
        <span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full font-medium">Optional</span>
        </div>

        <div class="flex items-center gap-4 flex-wrap">
        <input
            #jdFileInput
            type="file"
            (change)="onJdFileSelected($event)"
            accept=".pdf"
            class="hidden"
        />

        <button
            type="button"
            (click)="jdFileInput.click()"
            [disabled]="isExtractingJd"
            class="px-4 py-2 bg-white border border-blue-300 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-50 transition-colors flex items-center gap-2 shadow-sm disabled:opacity-50 disabled:cursor-not-allowed">
            <svg *ngIf="!isExtractingJd" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            <span *ngIf="isExtractingJd" class="animate-spin inline-block w-4 h-4 border-2 border-blue-400 border-t-transparent rounded-full"></span>
            {{ isExtractingJd ? 'Extracting...' : 'Upload Job PDF' }}
        </button>

        <span *ngIf="jdFileName" class="text-sm text-green-700 font-medium flex items-center gap-1">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            {{ jdFileName }}
        </span>

        <span *ngIf="jdExtractionError" class="text-sm text-red-600 flex items-center gap-1">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            {{ jdExtractionError }}
        </span>
        </div>
    </div>

    <form [formGroup]="jobForm" (ngSubmit)="onSubmit()" class="space-y-6 bg-white p-6 rounded-lg shadow-md">
        <!-- Job Title --> 
        <div>
            <label class="block text-sm font-medium mb-2 text-gray-700">Job Title *
                <span *ngIf="fieldsAutoFilled" class="ml-2 text-xs text-green-600 font-normal bg-green-50 px-2 py-0.5 rounded-full">✓ Auto-filled</span>
            </label>
            <input 
            type="text"
            formControlName="title" 
            class="w-full p-3 border rounded focus:ring-2 focus:ring-blue-500 transition"
            placeholder="e.g.. Senior Ruby Software Engineer"
            [class.border-red-500]="jobForm.get('title')?.invalid && jobForm.get('title')?.touched"
            />
            <p *ngIf="jobForm.get('title')?.invalid && jobForm.get('title')?.touched" 
               class="text-red-500 text-sm mt-1">
                Job title is required
            </p>
        </div>

        <!-- Job Description-->
        <div>
            <label class="block text-sm font-medium mb-2 text-gray-700">Job Description *
                <span *ngIf="fieldsAutoFilled" class="ml-2 text-xs text-green-600 font-normal bg-green-50 px-2 py-0.5 rounded-full">
                ✓ Auto-filled
                </span>
            </label>
            <textarea 
                formControlName="description"
                rows="6"
                class="w-full p-3 border rounded focus:ring-2 focus:ring-blue-500 transition"
                [class.border-red-500]="jobForm.get('description')?.invalid && jobForm.get('description')?.touched"
                placeholder="Paste the job description here ...">      
            </textarea>
            <p *ngIf="jobForm.get('description')?.invalid && jobForm.get('description')?.touched" 
               class="text-red-500 text-sm mt-1">
                Job description is required (minimum 50 characters)
            </p>
        </div>

        <!-- Resume Upload -->
        <div>
            <label class="block text-sm font-medium mb-2 text-gray-700">Upload your Resume/CV *</label>
            
            <div class="flex flex-col gap-3">
                <input 
                    #fileInput
                    type="file"
                    (change)="onFileSelected($event)"
                    accept=".pdf,.docx"
                    class="hidden"
                />

                <div class="flex items-center gap-4">
                    <button 
                        type="button"
                        (click)="fileInput.click()"
                        class="px-4 py-2 bg-gray-100 border border-gray-300 rounded-lg text-sm font-medium hover:bg-gray-200 transition-colors flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                        </svg>
                        Choose File
                    </button>

                    <span class="text-sm text-gray-500 italic">
                        {{ selectedFile ? selectedFile.name : 'No file selected' }}
                    </span>
                </div>

                <p class="text-xs text-gray-400">Supported formats: PDF, DOCX (Max 10MB)</p>
            </div>

            <div *ngIf="selectedFile" class="mt-2">
                <p class="text-sm text-green-600 font-medium flex items-center gap-1">
                    <span class="text-lg">✓</span> File ready for analysis
                </p>
            </div>
        </div>

        <!-- Submit Button-->
        <div class="flex gap-4">
            <button
                type="submit"
                [disabled]="jobForm.invalid || !selectedFile || isLoading"
                class="flex-1 bg-blue-600 text-white px-6 py-3 rounded hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-all font-medium">
                <span *ngIf="!isLoading">Analyze Resume</span>
                <span *ngIf="isLoading">{{ loadingMessage }}</span>
            </button>

            <button
                type="button"
                (click)="resetForm()"
                class="px-6 py-3 border border-gray-300 rounded hover:bg-gray-50 transition disabled:opacity-50">
                Reset
            </button>
        </div>
    </form>

    <!--Analysis Status -->
    <div *ngIf="isAnalyzing" class="mt-8 p-6 bg-blue-50 rounded-lg border-l-4 border-blue-500">
        <div class="flex items-center">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mr-4"></div>
            <div>
                <h3 class="font-semibold text-blue-900">{{ analysisStatus }}</h3>
                <p class="text-sm text-blue-700">This usually takes 2-3 minutes...</p>
            </div>
        </div>
    </div>

    <!-- Error Message -->
    <div *ngIf="errorMessage" class="mt-8 p-6 bg-red-50 rounded-lg border-l-4 border-red-500">
        <h3 class="font-semibold text-red-900">Error</h3>
        <p class="text-sm text-red-700">{{ errorMessage }}</p>
    </div>

    <!-- Analysis Result Section-->
    <div *ngIf="analysisResult" class="mt-8 p-6 bg-white rounded-lg shadow-md analysis-result">
        <h2 class="text-2xl font-bold mb-4 text-gray-800">Analysis Result</h2>

        <div class="space-y-6">
            <!-- Match Score -->
            <div class="text-center p-6 rounded-lg"
                 [ngClass]="{
                     'bg-green-50': analysisResult.match_score >= 70,
                     'bg-yellow-50': analysisResult.match_score >= 50 && analysisResult.match_score < 70,
                     'bg-red-50': analysisResult.match_score < 50
                 }">
                <p class="text-sm text-gray-600 mb-2">Match Score</p>
                <p class="text-5xl font-bold"
                   [ngClass]="{
                       'text-green-600': analysisResult.match_score >= 70,
                       'text-yellow-600': analysisResult.match_score >= 50 && analysisResult.match_score < 70,
                       'text-red-600': analysisResult.match_score < 50
                   }">
                    {{ analysisResult.match_score }}%
                </p>
                <p class="text-lg font-semibold mt-2"
                   [ngClass]="{
                       'text-green-700': analysisResult.verdict === 'STRONG_MATCH',
                       'text-blue-700': analysisResult.verdict === 'GOOD_MATCH',
                       'text-yellow-700': analysisResult.verdict === 'PARTIAL_MATCH',
                       'text-red-700': analysisResult.verdict === 'WEAK_MATCH'
                   }">
                    {{ formatVerdict(analysisResult.verdict) }}
                </p>
            </div>

            <!-- Display Summary-->
            <div class="border-l-4 border-blue-500 pl-4">
                <h3 class="font-semibold text-lg text-gray-800">Summary</h3>
                <p class="mt-2 text-gray-700">{{ analysisResult.summary }}</p>
            </div>


            <div class="grid md:grid-cols-2 gap-6"
            >
                <!-- Display Strengths-->
                <div class="strengths-section p-4 rounded bg-green-50">
                    <h3 class="font-semibold text-lg text-green-600 flex items-center gap-2 mb-2">
                        <span>✓</span>Strengths</h3>
                    <div class="text-gray-700" [innerHTML]="analysisResult.strengths"></div>
                </div>
            
                <!-- Display Weaknesses-->
                <div class="weaknesses-section p-4 rounded bg-red-50">
                    <h3 class="font-semibold text-lg text-red-600 flex items-center gap-2 mb-2">
                        <span>⚠</span> Areas for Improvement
                    </h3>
                    <div class="text-gray-700" [innerHTML]="analysisResult.weaknesses"></div>
                </div>
            </div>

            <!-- Display Recommendations -->
            <div class="border-l-4 border-purple-500 pl-4">
                <h3 class="font-semibold text-lg text-gray-800">Recommendations</h3>
                <div class="mt-2 text-gray-700" [innerHTML]="analysisResult.recommendations"></div>
            </div>

            <!-- Missing Keywords -->
            <div *ngIf="analysisResult.missing_keywords?.length > 0" 
                 class="border-l-4 border-orange-500 pl-4">
                <h3 class="font-semibold text-lg text-gray-800">Missing Keywords (Add to Resume)</h3>
                <div class="mt-2 flex flex-wrap gap-2">
                    <span *ngFor="let keyword of analysisResult.missing_keywords"
                          class="px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-sm font-medium">
                        {{ keyword }}
                    </span>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-4 pt-4 border-t">
                <button 
                    (click)="resetForm()"
                    class="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">
                    Analyze Another Resume
                </button>
                <button 
                    (click)="printResults()"
                    class="px-6 py-2 border border-gray-300 rounded hover:bg-gray-50 transition">
                    Print Results
                </button>
            </div>
        </div>
    </div>
</div>

